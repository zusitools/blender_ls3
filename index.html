<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/transitional.dtd">
<html>
  <head>
<title>Dokumentation für den Blender-LS3-Import/Export</title>
<meta http-equiv="content-type" content="text/html; charset=utf8">
<style type="text/css">
dt { font-weight: bold }
.klein { font-size: 80% }
table { border: 1px solid gray; border-collapse: collapse; margin: 1em 0; }
td, th { border: 1px solid gray; padding: 0.2em; }
</style>
  </head>
  <body>

<h1>Installation</h1>
<p>siehe Readme unter <a href="https://github.com/zusitools/blender_ls3">https://github.com/zusitools/blender_ls3</a></p>

<p>Es wird Blender Version 2.66 oder höher vorausgesetzt.</p>

<h1>LS3-Export</h1>

<p>Der LS3-Export kann unter „File → Export → Zusi-Landschaft (.ls3)“ oder unter „<em>Leertaste</em> → LS3 exportieren“ aufgerufen werden.</p>

<h2>Export-Einstellungen</h2>

<img src="exporteinstellungen.png" />

<dl>
	<dt>Varianten</dt><dd>Wird <a href="#varianten-export">weiter unten</a> erklärt</dd>
	<dt>Export</dt><dd>Legt fest, welche Objekte exportiert werden sollen.
		<dl>
			<dt>Alle Objekte</dt><dd>Alle in der Szene befindlichen Objekte werden exportiert</dd>
			<dt>Ausgewählte Objekte</dt><dd>Nur die in Blender ausgewählten Objekte werden exportiert.</dd>
			<dt>Subsets der ausgewählten Objekte</dt><dd>Alle Subsets, die mindestens ein ausgewähltes Objekt enthalten, werden exportiert. Für den Export eines einzelnen Subsets genügt es also, ein Objekt aus diesem Subset auszuwählen und diesen Exportmodus einzustellen.</dd>
		</dl>
		Die Varianten-Sichtbarkeit hat Priorität, d.h. ein ausgewähltes Objekt, das in keiner der zu exportierenden Varianten sichtbar ist, wird auch in der Einstellung „Selected objects“ nicht exportiert.
	</dd>
	<dt>Mesh optimieren</dt><dd>Aktiviert eine Optimierung zur Reduzierung der Vertexzahl eines Subsets. Das Aktivieren dieser Option ist dringend zu empfehlen, da die exportierte Datei sonst unnötig viele Vertices enthält.
</dl>

<h2>Subset-Export</h2>

<img src="objekteinstellungen.png" />

<p>Es kann manchmal nötig sein, ein Zusi-Mesh-Subset als mehrere Objekte in Blender anzulegen. Beispielsweise könnte ein Wagenkasten zum größten Teil symmetrisch sein, sodass man mit dem Mirror-Modifier arbeiten kann, aber einige Teile wie Beschriftungen könnten nur einseitig vorkommen. In diesem Fall kann man Wagenkasten und Beschriftungen als getrennte Objekte anlegen, ihnen aber dasselbe Material zuweisen. Dann werden sie beim Export automatisch zu einem Subset verschmelzen.</p>

<p>Alle Faces, denen dasselbe Material zugeordnet ist, landen beim Export in demselben Subset. Das ist normalerweise die gewünschte Variante; es entspricht der Funktion „Mesh-Subsets zusammenführen“ im Zusi-3D-Editor. In Spezialfällen kann man in den Eigenschaften eines Objektes einen Subset-Namen vergeben, dann wird dieses Objekt immer in einem anderen Subset als Objekte mit anderem oder leerem Subset-Namen exportiert werden. Normalerweise sollte man aber keinen Subset-Namen vergeben müssen.</p>

<p>Beim Export werden die Subsets sortiert, und zwar erst alphabetisch aufsteigend nach dem Subsetnamen, dann alphabetisch aufsteigend nach dem Materialnamen. Transparente Materialien sollte man also so benennen, dass sie als letztes exportiert werden, beispielsweise „zz_Transparent“.</p>

<h2><a name="varianten-export" />Varianten-Export</h2>

<p>Mehrere Varianten eines Objekts unterscheiden sich oft nur in Details. Ein Beispiel sind unterschiedliche Lackierungen, bei denen im Idealfall nur die Textur ausgetauscht werden muss. Der Exporter unterstützt deshalb die Bauweise, alle Varianten in einer Datei zu bauen. Für Objekte und Texturen kann man festlegen, ob sie in der gerade exportierten Variante sichtbar sein sollen.</p>
    
<p>Beim Bau kann man mit der Taste „H“ Objekte unsichtbar machen, mit „Alt+H“ werden sie wieder sichtbar. Die Funktion <a href="#varianten-anzeigen">„Varianten anzeigen“</a> versteckt und zeigt Objekte und Texturen abhängig von der ausgewählten Variante.</p>

<p>Varianten müssen zunächst global für die Szene definiert werden. Dies geschieht in den Szeneneinstellungen: Über die Knöpfe „+“ und „-“ können Varianten hinzugefügt und gelöscht werden.</p>

<img src="varianteneinstellungen.png" />

<p>Für jedes Objekt und jede Textur kann eine Varianten-Sichtbarkeit festgelegt werden. Dazu ist für jede Variante ein Ankreuzfeld vorgesehen (siehe Screenshot weiter oben). Standardmäßig sind Objekte und Texturen immer sichtbar. Es kann festgelegt werden, dass das Objekt/die Textur nur in den ausgewählten Varianten sichtbar sein soll oder nur in den ausgewählten Varianten unsichtbar sein soll.</p>

<p>Beim Export kann man auswählen, welche Varianten in die exportierte Datei übernommen werden sollen. Wenn man keine Variante ankreuzt, werden die Einstellungen zur Varianten-Sichtbarkeit ignoriert.</p>

<p>In Blender kann man in den Materialeinstellungen Texturen über das Ankreuzkästchen sichtbar und unsichtbar schalten. Normalerweise berücksichtigt das der Exporter, benutzt also die ersten beiden Texturen, die angekreuzt sind. Wenn jedoch beim Export Varianten ausgewählt wurden, werden stattdessen die ersten beiden Texturen genutzt, die in den gewählten Varianten sichtbar sind.</p>

<h2><a name="varianten-anzeigen"/>Varianten anzeigen</h2>

<p>Diese Funktion erlaubt die Auswahl einer oder mehrerer Varianten (wie beim Export) und blendet die Objekte und Texturen aus, die in den ausgewählten Varianten nicht sichtbar sind. Aufzurufen ist sie im Menü des 3D-Fensters unter „View → Varianten anzeigen …“. Die Varianten-Auswahlliste wird dann im „Tool Shelf“-Bereich auf der linken Seite des 3D-Fensters (Taste T) gezeigt.</p>

<img src="variantenanzeigen.png" />

<p>Beim Auswählen einer Variante wird die Änderung im 3D-Fenster sofort sichtbar.</p>

<h2>Zusi-spezifische Einstellungen</h2>

<p>In der Blender-Datei können einige Zusi-spezifische Einstellungen hinterlegt werden. Auf den folgenden Bildern ist zu sehen, wo sich die Bedienelemente des Mesh-Subset-Editors in Blender wiederfinden.</p>

<h3>Szeneneinstellungen</h3>

<img src="dateiinfo.png" />

<h3>Materialeinstellungen</h3>

<img src="subseteditor.png" />

<h4>Hinweis zu Nachtfarben</h4>

<p>Die Einstellung für die Tagfarben (Ambient und Diffuse) werden in Blender anders vorgenommen als im Zusi-3D-Editor. Auswirkungen hat das bei Objekten, die nachts leuchten sollen. Beispiel: Ein Objekt soll tagsüber weiß sein (#FFFFFF) und nachts gelb leuchten (#FFFF00). Dann müsste man im Zusi-3D-Editor und in Blender jeweils die folgenden Farben einstellen:</p>

<table>
    <thead><tr><th></th><th>Zusi</th><th>Blender</th></tr></thead>
    <tbody>
        <tr><td>Diffuse</td><td>blau (#0000FF)</td><td>weiß (#FFFFFF)</td></tr>
        <tr><td>Nachtfarbe</td><td>gelb (#FFFF00)</td><td>gelb (#FFFF00)</td></tr>
    </tbody>
<table>

    <p>Zusi addiert Nachtfarbe und Diffuse, um die Farbe bei Tag zu erhalten. Wenn das Exportskript genauso vorgehen würde, müsste man in Blender ein blaues Objekt erstellen, was das Arbeiten erschweren würde. Stattdessen gibt man in Blender die intuitiv richtige Tagfarbe ein, beim Export wird dann in die Zusi-Konvention umgerechnet.</p>

<h4>Hinweis zur hexadezimalen Eingabe von Farben</h4>

<p>Im Farbwähler von Blender können Farben auch in RGB-Hexadezimalschreibweise eingegeben werden. Die Farbverwaltung Blender sorgt aber dafür, dass sich die Werte aus Zusi nicht direkt übernehmen lassen. Will man das tun, so muss man in den Szeneneinstellungen unter "Color management" das "Display Device" auf "None" stellen.</p>

<p><img src="color_management.png" /></p>

<h2>Scharfe Kanten</h2>

<p>Es besteht die Möglichkeit, Kanten explizit als scharf zu markieren. Dann werden die Vertices, aus denen diese Kanten bestehen, von der Mesh-Optimierung unabhängig vom Winkel zwischen den Normalen niemals zusammengefasst.</p>

<p>In Blender kann eine Kante unter „Mesh → Edges → Mark sharp“ als scharf markiert werden. (Wenn man im „Tool Shelf“-Bereich auf der linken Seite des 3D-Fensters (Taste T) einen Haken vor „Clear“ setzt, wird die Markierung wieder gelöscht). Scharfe Kanten werden im Editmode blau dargestellt:</p>

<img src="sharpedges.png" />

<p>Ein Beispiel soll den Unterschied verdeutlichen. Die Kanten des rechten Zylinders sind alle als scharf markiert, die des linken Zylinders nicht.</p>

<img src="sharpedges2.png" />

<p>Diese Objekte werden beide mit aktivierter Mesh-Optimierung exportiert, und zwar so, dass der Normalen-Grenzwinkel größer ist als der Winkel zwischen den Seitenflächen der Zylinder. Der linke Zylinder wirkt daher im Modellbetrachter glatt und rund, beim rechten wurden die Vertices nicht zusammengeführt und man kann man die einzelnen Flächen erkennen:</p>

<img src="sharpedges3.png" />

<h2>Stapel-Export</h2>

<p>Sind in einem Modell mehrere Varianten enthalten, kann es unter Umständen mühsam sein, sie nach einer Änderung alle einzeln zu exportieren. Für diesen Zweck gibt es die Funktion „Stapelexport LS3“, die mehrere Varianten auf einmal in vorher festgelegte Dateien exportiert.</p>

<p>Dazu muss in der Datei <code>batchexport_settings.xml</code> ein Eintrag für die Blender-Datei angelegt werden. Das Dateiformat ist in der Datei selbst beschrieben.</p>

<h1>LS-/LS3-Import</h1>

<p>Der LS3-Import kann unter „File → Import → Zusi-Landschaft (.ls3)“ oder unter „<em>Leertaste</em> → LS3 importieren“ aufgerufen werden. Ebenso kann man unter „File → Import → Zusi-2-Landschaft (.ls)“ oder unter „<em>Leertaste</em> → LS importieren“ Zusi-2-Landschaftsdateien importieren</p>

<p>Der Pfad zum Zusi-Datenverzeichnis wird unter Windows aus der Registry ausgelesen. Unter anderen Betriebssystemen muss man den Pfad manuell einstellen. Eine Anleitung dazu findet sich in der Datei <tt>zusiconfig.py.default</tt>.</p>

  </body>
</html>
